// CITS2202 Porject 1 2024 
// Student1:    STUDENT-NUMBER1    NAME-1 
// Student2:    STUDENT-NUMBER2    NAME-2 
// Platform:    Linux 

#include <ctype.h>
#include <stdio.h>
#include <string.h>
#include <stdlib.h>

typedef enum { 
    token_assignment, // <- 
    token_comment,    // #
    token_function,
    token_int,        // int 
    token_print,      // print
    token_space,      // space 
    token_sym,        // symbol 
    token_unknown,    // unknown tokens 
    token_name        // variable names
} Token; 

typedef struct {
   Token type;        // For types of token     
   char name[50];     // For variables such as x  
   int val;           // For integer values 
} identifier;            

int is_symbol(char c) {
    return (c == '.');
}  

identifier next_token(char input[], int *index) {
    identifier n_TOKEN;
    n_TOKEN.type     = token_unknown; 
    n_TOKEN.name[0]  = '\0';  
    n_TOKEN.val      = 0   ;
    
    int nameINDEX    = 0   ;
    int intINDEX     = 0   ;
    char num[50]           ; 
    
    if (input[*index] == '#') {
        //n_TOKEN.type = token_comment;
        //(*index)++;
        //return n_TOKEN; 
        
        
        (*index)++;
        n_TOKEN.type = token_comment; 
        while (input[*index] != '\n' && input[*index] != '\0') {
            (*index)++;
        }
        if (input[*index] == '\n') (*index)++;
        return n_TOKEN;
                
    } 
    
    // space 
    if (input[*index] == ' ') {
        n_TOKEN.type = token_space;
        (*index)++;
        return n_TOKEN;             
    } 
 
    if (input[*index] == '<' && input[*index + 1] == '-') {
        n_TOKEN.type = token_assignment;
        (*index) += 2;
        return n_TOKEN;             
    } 
 
    //if (isalpha(input[*index])) {
    //   n_TOKEN.type = token_name;
    //    (*index)++;
    //    return n_TOKEN; 
    //} 
    
    if (isalpha(input[*index])) {
        n_TOKEN.type = token_name; 
        while(isalpha(input[*index])) {
            n_TOKEN.name[nameINDEX++] = input[*index];       
            (*index)++;
        }
        n_TOKEN.name[nameINDEX] = '\0';
        
        if (strcmp(n_TOKEN.name, "function") == 0) {
            n_TOKEN.type = token_function;
            return n_TOKEN;
        }
        
        if (strcmp(n_TOKEN.name, "print") == 0) {
            n_TOKEN.type = token_print;
            return n_TOKEN;
        }
        
        return n_TOKEN; 
    } 
    
    if (isdigit(input[*index])) {
        n_TOKEN.type = token_int; 
        while(isdigit(input[*index])) {
            num[intINDEX++] = input[*index];       
            (*index)++;
        }
        num[intINDEX] = '\0';
        n_TOKEN.val = atoi(num);
        return n_TOKEN; 
    } 
    
    
    //if (isdigit(input[*index])) {
        
    //    n_TOKEN.type = token_int;
    //    n_TOKEN.val = input[*index];
     
    //    (*index)++;
    //    return n_TOKEN; 
    //} 
    
    
    if (is_symbol(input[*index])) {
        n_TOKEN.type = token_sym;
        (*index)++;
        return n_TOKEN; 
    } 
    
    (*index)++;
    return n_TOKEN;   
}



int parse(char *input) {
    
    identifier token; 
    int i = 0; 
    while (input[i] != '\0') { 
        //printf("%c", input[i]);
        token = next_token(input, &i);
        
        //if (token.type == token_comment) {
        //    printf(" comment\n");
        //}
        
        //if (token.type == token_space) {
        //    printf(" space\n");
        //}
        
        if (token.type == token_name) {
            printf("%s var_name\n", token.name);
        }
        
        if (token.type == token_int) {
            printf("%d int\n", token.val);
        }
    
        if (token.type == token_sym) {
            printf(" sym\n");
        }
        
        if (token.type == token_assignment) {
            printf("%c%c assignment\n", input[i], input[i + 1]);
        }
        
        if (token.type == token_function) {
            printf("%s funct\n", token.name);
        }
        
        if (token.type == token_print) {
            printf("%s print\n", token.name);
        }
    
    }
}  


int main(int argc, char *argv[]) {

    char input[1000];
    int index = 0;
    char ch;   
    FILE *file = fopen(argv[1], "r");
    
    // stores input file into array
    while ((ch = fgetc(file)) != EOF && index < sizeof(input) - 1) {
        input[index++] = ch;
    }
    input[index] = '\0';
    
    // printf("%s", input);
    
    fclose(file); 
    
    parse(input);
    
    return 0; 

} 
